---
description: 流动性质押池概述
---

# 流动性模块

初始代币供应量的 `2.50%`\（`25,000,000个DYDX`\）将分配给把USDC质押到流动性质押池的用户。

### 目标

* 鼓励在dYdX Layer 2协议上为做市目的分配USDC。
* 将资金分配给表现最好的流动性提供方，以提高dYdX的价差、深度和正常运行时间。

开始在[**dydx.community/dashboard/pools/liquidity**](https://dydx.community/dashboard/pools/liquidity)**上进行质押。**

## **质押**概述

流动性是任何成功交易所的核心组成部分。为提高流动性网络效应，激励专业流动性提供方，DYDX将被分配给向流动性质押池质押USDC的用户。社区批准的流动性提供方将使用质押的USDC基于dYdX Layer 2协议进行做市，从而进一步提高市场的可用流动性。流动性提供方被限制使用dYdX Layer 2协议以外的借贷资金。

质押人将通过质押USDC赚取DYDX奖励。DYDX奖励将根据每个质押人占质押池中总USDC的比例持续进行分配。

每个质押人和流动性提供方必须成为循环信贷协议的缔约方([此处链接](https://dydx.foundation/revolving-credit-agreement))。该协议将流动性质押池的条款用自然语言表达出来，赋予每个质押者针对任何不偿还所借USDC的流动性提供方的可执行权利。该协议仅在每个质押人与每个流动性提供方之间签署。dYdX基金会不是协议的缔约方，并且没有该协议的权利或义务。

## USDC解除质押和提现

质押人必须在[**时段**](../cong-ci-chu-kai-shi/epochs.md)结束前至少`14天`请求提现USDC\（**停市窗口期**\），才能在该时段结束后提现质押人的USDC。如果质押人不请求提现，他们质押的USDC将被转入下一时段。

在**停市窗口期**期间，无法请求提现。

## 质押风险

质押池中的借款人无需锁定抵押品。所有借款人都是专业和声誉良好的流动性提供方。允许的借款人及其资金池分配清单可由治理进行更新。

当用户请求提现USDC，一个借款人下一时段的分配余额可能会低于借款人当前借款金额。在这种情况下，借款人负责在时段结束前偿还借款与所分配余额之间的差额。

如果借款人未能在时段结束前将欠款余额还回到质押池，则被认为是违约，在债务偿还前，不允许借贷更多USDC。如果借款人永远不会偿还债务，质押人可能会失去USDC。如果做市商将失去USDC，并且无法补充流动性质押池，质押人可能会损失一部分质押USDC。

如果基本的智能合约代码存在漏洞，质押人也会面临智能合约风险。所有DYDX和治理智能合约都已被审计并进行了严格的测试。

为了减少质押人的风险，每个质押人和流动性提供方都必须成为循环信用协议的缔约方，([此处](https://dydx.foundation/revolving-credit-agreement)链接)，但签订该协议不能确保流动性提供方将偿还所有借款金额，即使根据协议强制执行质押人的权利，也是如此。

## 批准的借款人

流动性质押池合约是一种双侧、质押不足、无利息的流动性系统。

可以提现的金额取决于借款人分配比例和质押资金池中质押的USDC总量。USDC分配百分比和可用总数可以根据`LS1EpochSchedule`指定的预定义时间进行变更。借款的USDC只能在dYdX Layer 2协议上使用，此协议通过`StarkProxy`合约强制执行，该合约与`StarkEx永续交易所`合约互动。

初始获批准的流动性提供方包括`Wintermute`、`Amber Group`、`Wootrade (Kronos)`、`Sixtant`和`DAT Trading`，他们一直在dYdX Layer 2协议上积极做市。

| 事先批准的借款人          | 初始分配百分比 | 以太坊地址                                      | 流动性提供方的详细信息                                                                                                                                                                            |
| ----------------- | ------- | ------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Wintermute        | 25%     | 0x4f3a120E72C76c22ae802D129F599BFDbc31cb81 | [https://forums.dydx.community/proposal/discussion/1486-borrower-wintermute/](https://forums.dydx.community/proposal/discussion/1486-borrower-wintermute/)                             |
| Amber Group       | 25%     | 0x39ad99e33ab7ee85818741dd6076112188bc2611 | [https://forums.dydx.community/proposal/discussion/1487-borrower-amber-group/](https://forums.dydx.community/proposal/discussion/1487-borrower-amber-group/)                           |
| Wootrade (Kronos) | 20%     | 0x38d981c3c42b2ec8e9572f56052407d0f1279fb  | [https://forums.dydx.community/proposal/discussion/1485-borrower-wootrade-kronos-research/](https://forums.dydx.community/proposal/discussion/1485-borrower-wootrade-kronos-research/) |
| Sixtant           | 20%     | 0x89ded350b2be3dc2014c71f1e49cdfad17ccaf7c | [https://forums.dydx.community/proposal/discussion/1484-borrower-sixtant/](https://forums.dydx.community/proposal/discussion/1484-borrower-sixtant/)                                   |
| DAT Trading       | 10%     | 0x940ab7307c7971f9284ba9c19b3313600d79c48a | [https://forums.dydx.community/proposal/discussion/1483-borrower-dat-trading/](https://forums.dydx.community/proposal/discussion/1483-borrower-dat-trading/)                           |

## 质押余额会计处理

质押余额处于两种状态之一：

* **活跃**：可以用于借款；赚取质押奖励；质押人不能提现。
* **非活跃**：借款不可用；不赚取奖励；可以由质押人提现。

质押人可能具有活跃和非活跃余额的组合。USDC按时段进行计算，如以下示例所示：

![质押余额会计处理](<../.gitbook/assets/image (30).png>)

以下操作会影响质押余额，如下所示：

* **存款**：增加活跃余额。
* **请求提现**：在本时段结束时，将一些活跃USDC移至非活跃状态。
* **提现**：减少非活跃余额。
* **转让**：将一些活跃USDC移至另一个质押人。

如果要加密一个交易时间段结束时可能计划变更余额的事实，每个余额将作为三个字段的结构进行存储：currentEpoch、currentEpochBalance和nextEpochBalance。非活跃用户余额也利用shortfallCounter字段。

### 什么是stkUSDC？

将USDC存入并质押到流动性质押池的USDC持有人，将获得代币化头寸(**stkUSDC**)。stkUSDC在用户质押USDC时铸造，并在用户调用`withdrawStake`时进行烧制。在USDC离开质押人钱包的同一笔交易中，stkUSDC进入质押人钱包；解除质押时，反之亦然。

stkUSDC余额可能是活跃的或不活跃的。活跃的stkUSDC可以作为ERC-20转让，但不能提现。不活跃的stkUSDC可以提现，但不能转让。例如，用户的钱包中有100个活跃和100个不活跃的stkUSDC，用户的余额将显示200个stkUSDC，但如果用户试图转让超过100个stkUSDC，则转让将失败。

## **质押人**常见问题解答

### 我如何赚取质押奖励？

质押人可以随时将USDC存入流动性质押池，并立即开始赚取奖励。DYDX奖励是根据每秒每个质押人在总质押池中的比例持续赚取。可以随时申领奖励并提现。

质押的USDC在活跃时期内便会获得奖励。这意味着，在请求提现部分USDC后，USDC将继续赚取奖励，直至时段结束。例如：

![奖励会计处理](<../.gitbook/assets/image (60).png>)

在上述情景中，用户将从**Time0**到**Time2**期间内赚取奖励，随着该期间质押余额总数的变化而变化。如果用户仅请求提现部分用户余额，那么剩余的余额将在**Time2**后继续赚取奖励。

### 我如何存入USDC并质押到流动性质押池？

如果要将USDC质押到流动性质押池，请按照以下步骤操作：

* 转到[https://dydx.community/dashboard/pools/liquidity](https://dydx.community/dashboard/pools/liquidity)
* 单击“质押”
* 首次存入时，您必须启用USDC。这样只需操作一次，并仅支付一次gas费用。
* 输入您希望质押到质押池的USDC数量。
* 单击“质押资金”，您需要支付质押的gas费用、请求提现并提现USDC。

![](<../.gitbook/assets/image (59).png>)

质押的USDC现在已经活跃，并立即开始赚取奖励。

如果要直接在智能合约上存入并质押USDC，用户请调用`stake`函数。用户也可以调用`stakeFor`函数，代表另一个地址存入和质押USDC。即使您直接在智能合约上质押USDC，也将被视为您已注意到并查阅了《循环信贷协议》([此处](https://dydx.foundation/revolving-credit-agreement)链接)。

### 停市窗口期是什么？

停市窗口期是指一段时间，用户不能在此期间请求提现质押的USDC。停市窗口期期间，无法调用`requestWithdrawal`函数，该窗口期最初被配置为一个时段的最后`14天`。每28天开始新的时段。换句话说，用户可以在给定时段结束前最多`14天`请求提现。

### 我如何从质押资金池提现USDC？需要多长时间？

对提现强制执行时段时间表，以便为质押池中USDC的可用性提供可预测性和定期节奏。质押人必须至少在时段结束前至少`14天`请求解除质押USDC，才能在该时段结束后提现质押人的USDC。如果质押人不请求提现，他们质押的USDC将被转入下一时段。

如果要提现 USDC，用户请调用`requestWithdrawal`，以请求在下一时段提现USDC。用户资金将持续质押，并且无法在当前时段提现。从下一时段开始，资金将变成“非活跃”，并可用于提现。

在下一时段，用户将调用`withdrawStake`函数，将非活跃USDC提现至特定地址。用户可以选择要提取的非活跃资金金额或调用\`withdrawMaxStake\`函数以提取所有非活跃资金。`withdrawMaxStake`函数的gas效率低于通过eth\_call查询最大值和调用`withdrawStake()`。

如要将USDC解除质押到流动性质押池，按照以下步骤操作：

* 转到[**https://dydx.community/dashboard/staking-pool/liquidity**](https://dydx.community/dashboard/staking-pool/liquidity)\*\*\*\*
* 单击“**请求**”，以打开以下模式：

![请求提现](<../.gitbook/assets/image (68).png>)

* 输入您希望请求从资金池中提现的USDC金额，然后单击“**请求提现**”。您需要支付gas费以解除质押USDC。
* 如果质押人在当前时段结束前至少14天\（**停市窗口期**\）请求解除质押USDC，则可以在下一时段开始时提现USDC。

### 治理可以更改哪些参数？

dYdX治理负责：

* 对现有借款人进行尽职调查
* 将新借款人添加到质押流动性资金池中，和/或从资金池中删除现有借款人
* 更改将借款USDC分配给获批借款人的数额
  * 调用`setBorrowerAllocations`和`setBorrowingRestriction`函数，以更改某些借款人的分配。可以使用它们添加和删除借款人。增加将于下一时段生效，但减少将立即限制借贷。“停市窗口期”期间无法调用这些函数。
* 时段长度和停市窗口期在创建合约时确定，但可以更改

## **借款人常见问题解答**

### **借款**

质押的USDC进入一个资金池，以分配给经批准的借款人。每个借款人都拥有由治理控制的分配百分比，并可以在分配前借款。解除质押将受到“时段时间表”的限制，质押的USDC只能在时段开始时才可以提现\（即“非活跃”\）。

请求提现的USDC必须由借款人在时段结束前退还。如果欠款，未支付的金额将变成“债务余额”，质押合约被重新稳定。违约借款人必须偿还债务余额，并被限制借款，直到由治理恢复为止。

借款人受循环信贷协议\（[此处](https://dydx.foundation/revolving-credit-agreement)链接\）的所有条款的约束。

### **StarkProxy功能**

#### **自动付款**

借款人可以使用`autoPayOrBorrow()` 以确保最大限度利用分配的USDC并及时偿还请求的提现。该函数只需要在每个时段中为借款人成功调用一次，以确保他们履行其职责。

如果在时段上半段调用，该函数将恢复，因为这在“停市窗口期”之外。如果`StarkProxy`合约没有足够的USDC用于偿还，则会恢复。在这种情况下，必须添加USDC或从交易所提现，再调用`autoPayOrborrow()`。

#### **质押人拥有的USDC**

借款人可以在与借款USDC相同的账户中，安全地将自己的USDC存入`StarkProxy`并用于dYdX Layer 2协议。在下列任何一种情况下，可以从`StarkProxy`提现USDC：

* 在`StarkProxy`合约中持有超过借款余额的USDC可以随时提现。
* 治理可以批准某种数额的提现。
  * 注意：可以利用此方法允许借款人提现利润，而不必将大多数USDC从dYdX Layer 2协议中移出。

#### **借款人角色**

`StarkProxy`合约支持以下由借款人控制的角色。这些可以根据借款人的保险需求由一个地址或单独的地址持有。每种角色可以由任何数量的地址来持有。

所有者

* 授予或撤销委托管理员的角色。
* 添加或删除`StarkProxy`中提现的USDC的允许接收者。
* 添加或删除在dYdX Layer 2协议上使用的允许的STARK密钥。
* 在`LiquidityStakingV1`和`StarkPerpetual`合约上设定ERC20限额。
* 在`StarkEx永续交易所`合约上调用`forcedWithdrawalRequest()`或`forcedTradeRequest()`。

委托管理

* 授予或撤销借款人、交易所操作员和提现操作员角色。

借款人

* 在流动性质押合约上调用`autoPayOrBorrow()`、`borrow()`、`repay()`和`repayDebt()`。

交易所操作员

* 在`StarkEx永续交易所`合约上调用`registerUserOnExchange()`、`depositToExchange()`和`withdrawFromExchange()`。

提现操作员

* 向获允许的接收者提出从`StarkProxy`中进行有效的外部提现\（见上文\）。

#### **限制**

在dYdX Layer 2协议上，Layer 2转让因`StarkProxy`控制的账户而被禁用。

#### **监护权**

监护人角色将由dYdX治理控制。其职责是确保借款USDC的安全，并在借款人私人密钥丢失或滥用时允许他们退还给质押人。

监护人可以在任何时候采取以下行动\（视时间锁而定\）：

* 将借款USDC的借贷和存入限制在交易所。
* 使用`StarkProxy`合约的USDC来偿还借款余额。
* 使用`StarkProxy`合约的USDC偿还债务余额。
* 从StarkEx合约提现到`StarkProxy`合约\（例如，作为交易所正常提现的第二步\）。
* 取消借款人发起的强制交易请求。
* 批准借款人从`StarkProxy`合约提现，同时绕过余额检查。
* 升级智能合约。

**如果借款人有未偿债务余额，则监护人可以采取以下行动\（视时间锁而定\）：**

* 从dYdX Layer 2协议中强制提现。
* 在dYdX Layer 2协议上进行强制交易(仅限于削减)。

## 质押风险常见问题解答

### 质押到流动性质押池的风险是什么？如果借款人未能偿还借款资金，会发生什么？

非质押借款的系统需要更高的信托标准，借款人必须达到该标准。从流动性质押池中借贷的流动性提供方不能在流动性质押系统和dYdX Layer 2协议之外转移借贷的资金。但是，如果流动性提供方将失去资金交易，并且无法通过外部资金来源补充其借贷的分配，那么质押的USDC可能会亏损。

在这种情况下，如果借款人迟迟未偿还请求提现的资金，那么不活跃资金可能会受到以下社会化损失。如果借款资金出现违约，一个拖欠的借款人将面临严重的声誉损害。

尽管每个质押人和借款人都是循环信贷协议\（链接[此处](https://dydx.foundation/revolving-credit-agreement)\）的缔约方，该协议没有提供质押人将偿还债务的保证。

### 合约如何维持偿债能力？

在任何时候，合约将根据质押余额和借款余额之间的关系处于以下其中一种状态：

![合约偿债能力](<../.gitbook/assets/image (41).png>)

在以下情况下，合约**无法偿债**：

* 如果借款余额总额超过总活跃余额；
* 或者如果非活跃总余额超过未借贷总余额；
* 或者如果可提现余额总数超过合约的USDC余额。

否则，合约被认为是**可以偿债**。

由于借款限于借款人分配的活跃USDC比例，而且由于非活跃余额只能在时段之间增加，因此在时段之间的过渡期间，合约通常只能从偿债状态变成无法偿债状态。

如果在新时段开始时，合约已经无法偿债，那么尽快重新稳定是至关重要的。偿债能力通过一种称为“债务核算”的机制来恢复。一旦合约无法偿债，任何人都可以通过指定超过分配的借款人名单来调用`MarkDebt()`函数。借款人借贷余额超过分配的数额称为借款人资金缺口数额。

当调用`MarkDebt()`时，每个借款人资金缺口数额将从借款余额中挪出，并进入称为债务余额的余额中。与此同时，这些资金缺口的总数来自质押人不活跃余额，并以质押人债务收据形式进行分配。每个质押人不活跃余额将进行折扣，每个质押人将以债务形式收到相应的金额。这样，无法偿债导致的损失将在所有持有非活跃余额的质押人中社会化\（按比例\）。

该过程如下所示：

![违约](<../.gitbook/assets/image (44).png>)

### 债务代表什么？

如果借款人违约，则资金缺口数额\（最多达100%的非活跃余额\）从非活跃余额中转换为债务余额\（在非活跃余额持有人中进行损失社会化\）。质押人的债务余额并非使质押人有权从质押USDC资金池中提现，必须以债务偿还形式具体地予以偿还。

债务代表USDC的收据，此后可以赎回USDC，或者在借款人偿还债务时，或者通过治理确定的另一种补救手段进行。

### 如果借款人违约，质押人可以获得哪些追溯权？

质押人和借款人是循环信贷协议\（链接[此处](https://dydx.foundation/revolving-credit-agreement)\）缔约方，该协议旨在在每个质押人与每个借款人之间建立可执行的协议。此外，流动性质押池智能合约旨在让质押人对借款人追索，尽管无法保证偿还。

当对借款人调用`MarkDebt()`时，借款人失去从合约中借贷任何进一步资金的权利。该权利可以通过治理恢复。

一旦债务被“标记”，就会从主要会计系统中删除，并可以由质押人多种方式予以追回。如果负债的借款人偿还债务（或者如果另一方，例如治理，代表其偿还债务），那么欠债的质押人可以按照先到先得的原则收回资金。可以通过智能合约的“债务操作员”接口来实施更灵活的解决方案。

质押人收到债务后，实际发生的情况将取决于实际情境。如果是被批准的借款人犯了诚实的错误，那么质押人可能会期望迅速全额偿还。如果USDC资金亏损，治理可以向受影响的质押人发放部分偿还金额。如果解决方案不确定，治理可以选择向受影响的质押人签发ERC20收据，使他们在等待解决方案时立即获得流动性。如果认为适当，治理可以选择向收据持有人发放利息付款，直到达成决议。

所有这些案件都基本上得到质押合约的支持，但必须由dYdX治理来决定并执行适当的回复。视情况，这可能要求制定和部署周边智能合约。
