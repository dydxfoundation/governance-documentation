---
description: Обзор архитектуры управления и смарт-контрактов.
---

# Технический обзор

## Обзор архитектуры управления

Ончейн-управление dYdX позволяет следующее:

* Создавать предложения и голосовать по ним
* Получать снимки находящихся во владении токенов в начале процесса внесения предложения
* Делегировать отдельные права голоса и права на внесение предложений
* Устанавливать пороговые значения для управления, в том числе для числа предложений, кворума, а также разницы в количестве голосов
* Заменять смарт-контракт на стратегию управления, определяющий принцип подсчета голосов
* Настраивать несколько контрактов исполнителя, которые позволяют следующее:
   * быстро вносить изменения в протокол и распределять средства благодаря исполнителям с правом на короткую блокировку по времени;
   * модернизировать процесс управления благодаря исполнителям с правом на длительную блокировку по времени.

Существует шесть смарт-контрактов, обеспечивающих управление dYdX:

* **Контракт на `токен DYDX`**: содержит снимки, которые поддерживают запросы на получение права голоса и права на внесение предложений адресов в любом номере блока. Поддерживает делегирование отдельных прав голоса и прав на внесение предложений.
* **Контракт `управляющего DYDX`**: отслеживает и может исполнять предложения с помощью смарт-контракта на блокировку по времени.
* **Контракты `исполнителя`**: может помещать в очередь, отменять или выполнять операции, за которые проголосовало управление. Если предложение принято, то с помощью контракта исполнителя, указанного в предложении, можно вызывать функции. С помощью контракта исполнителя можно определять продолжительность задержки, с которой выполняются операции, находящиеся в очереди.
* ******Контракт на** **`приоритетную блокировку по времени`**: аналогичен контракту на блокировку по времени, но позволяет контролеру приоритета исполнять операции в течение **периода приоритета** (7 дней) до окончания задержки блокировки по времени.
* **Контракт на `стратегию управления`**: содержит логическую схему подсчета голосов. В настоящее время осуществляет подсчет голосов для токенов DYDX и модуля безопасности. Может быть модернизирован с помощью длительной блокировки по времени.
* **Контракт на `модуль безопасности`**: содержит логическую схему стейкинга токенов DYDX, токенизации размещенной в стейке позиции и получения наград при сохранении права голоса и права на внесение предложений, а также функций делегирования базовых токенов.

{% tabs %}
 {% tab title="Mainnet" %}
 | Контракт                             | Адрес                                    |
 | ------------------------------------ | ------------------------------------------ |
 | Токен Dydx                            | 0x92D6C1e31e14520e676a687F0a93788B716BEff5 |
 | Управляющий Dydx                         | 0x7E9B1672616FF6D6629Ef2879419aaE79A9018D2 |
 | Исполнитель с правом на короткую блокировку по времени              | 0x64c7d40c07EFAbec2AafdC243bF59eaF2195c6dc |
 | Исполнитель с правом на длительную блокировку по времени               | 0xEcaE9BF44A21d00E2350a42127A377Bf5856d84B |
 | Исполнитель с правом на остановку дерева Меркла      | 0xd98e7A71BacB6F11438A8271dDB2EFd7f9361F52 |
 | Исполнитель Starkware с правом на приоритетную блокировку по времени | 0xa306989BA6BcacdECCf3C0614FfF2B8C668e3CaE |
 | Казна наград                     | 0x639192D54431F8c816368D3FB4107Bc168d0E871 |
 | Казна сообщества                   | 0xE710CEd57456D3A16152c32835B5FB4E72D9eA5b |
 | Модуль безопасности                        | 0x65f7BA4Ec257AF7c55fd5854E5f6356bBd0fb8EC |
 | Стратегия управления                   | 0x90Dfd35F4a0BB2d30CDf66508085e33C353475D9 |
 | Вестинг казны наград              | 0xb9431E19B29B952d9358025f680077C3Fd37292f |
 | Вестинг казны сообщества            | 0x08a90Fe0741B7DeF03fB290cc7B273F1855767D8 |
 | Дистрибьютор Меркла                   | 0x01d3348601968aB85b4bb028979006eac235a588 |
 | Адаптер Chainlink                    | 0x99B0599952a4FD2d1A1561Fa4C010827EaD30354 |
 | Стейкинг ликвидности                    | 0x5Aa653A076c1dbB47cec8C1B4d152444CAD91941 |
 | Доверенность получения                         | 0x0fd829C3365A225FB9226e75c97c3A114bD3199e |
 | Вспомогательный управляющий StarkEx              | 0x0db9b3F7Dd83e29C9bece8E5e1089bA4369E694a |
 | Управляющий удалением StarkEx V2          | 0xFCAac0F14deA11eDe11Afcb875f29130e1ad5ec0 |
 | Администрирование доверенности казны наград         | 0x40D6992cbd03E0DC1c2DE9606D29Cb245E737a5d |
 | Администрирование доверенности казны сообщества       | 0x9d51599A6b10f562619D8ef2EFDcA1B68aE80D03 |
 | Администрирование доверенности модуля безопасности            | 0x6aaD0BCfbD91963Cf2c8FB042091fd411FB05b3C |
 | Администрирование доверенности дистрибьютора Меркла       | 0x6C5cd3aD7A16Ae207D221908E6b997d9B0DcD7b0 |
 | Администрирование доверенности стейкинга ликвидности        | 0xAc5D8bCD13da463bea96c75f9085c4e40037F790 |
 | StarkProxy \[0]                      | 0x0b2B08AC98a1568A34208121c26F4F41a9e0FbB6 |
 | StarkProxy \[1]                      | 0x3e6E9EFb0A677a24F47093a22044dc5451A028cF |
 | StarkProxy \[2]                      | 0xCB7fa3a2F47b62293Cc2E1a4C7752fC72E49FCe2 |
 | StarkProxy \[3]                      | 0x16BEC2D9A010e7D8b2D576d17893C52Ddbfe4C06 |
 | StarkProxy \[4]                      | 0x531F3BE462F10386D01FBeD7fAD1d20A61Ce7874 |
 | Администрирование доверенности StarkProxy \[0]          | 0xE16718eace44e0CB06b9cd164490A69A6425D1e3 |
 | Администрирование доверенности StarkProxy \[1]          | 0x78e899e576C3565C3219dbC9Ea5042A9DBed36d3 |
 | Администрирование доверенности StarkProxy \[2]          | 0x15774D4555fEfD57C9Fc8b11C8beba993eafcc13 |
 | Администрирование доверенности StarkProxy \[3]          | 0x4d9460e5C958f46a1Fe129954A069a37972f16EA |
 | Администрирование доверенности StarkProxy \[4]          | 0xfa45DCDbEc82C94082d283B62506320DB8632054 |
 {% endtab %}
 {% endtabs %}

## Открытый исходный код и проверка

Весь исходный код смарт-контракта для контрактов на управление и пулы стейкинга можно найти по адресу [https://github.com/dydxfoundation/governance-contracts](https://github.com/dydxfoundation/governance-contracts).

Исходный код интерфейса управления dydx.community, можно найти [здесь](https://github.com/dydxfoundation/pnyx).

Все новые основные смарт-контракты прошли проверку компанией Peckshield. Важных или высокоприоритетных проблем безопасности не обнаружено. Базовые контракты на управление и токены получены при использовании кодовой базы контрактов на управление AAVA, которые прошли проверку [CertiK](https://www.certik.io), [Certora](https://www.certora.com) и [Peckshield](https://peckshield.com/en) и в течение многих месяцев испытывались на практике в основной сети.

## Базовые контракты на управление

![Red dashed lines indicate contract is upgradeable](<.. /.gitbook/assets/Screen Shot 2021-09-03 at 5.17.43 PM.png>)

### Токен DYDX

Контракт на токен DYDX был вдохновлен протоколом Aave. Специалисты dYdX внесли в него незначительные изменения.

Контракт на токен DYDX развернут в основной сети Ethereum по адресу [0x92D6C1e31e14520e676a687F0a93788B716BEff5](https://etherscan.io/address/0x92d6c1e31e14520e676a687f0a93788b716beff5). Он был создан на основе фиксации транзакции \[ожидается в ближайшее время].

**УКАЗАТЬ**

\[ожидается в ближайшее время]

### Управляющий DYDX

Контракт управляющего DYDX был вдохновлен протоколом Aave. Специалисты dYdX внесли в него незначительные изменения.

Контракт управляющего развернут в основной сети Ethereum по адресу [0x7E9B1672616FF6D6629Ef2879419aaE79A9018D2](https://etherscan.io/address/0x7e9b1672616ff6d6629ef2879419aae79a9018d2). Он был создан на основе фиксации транзакции \[ожидается в ближайшее время].

### Стратегия управления

Контракт на стратегию управления был вдохновлен Aave.

Стратегия развернута по адресу [0x90Dfd35F4a0BB2d30CDf66508085e33C353475D9](https://etherscan.io/address/0x90Dfd35F4a0BB2d30CDf66508085e33C353475D9) в основной сети Ethereum. Он был создан на основе фиксации транзакции \[ожидается в ближайшее время].

**УКАЗАТЬ**

\[ожидается в ближайшее время]

### Исполнители

Контракт исполнителя был вдохновлен протоколом Aave. Специалисты dYdX внесли в него незначительные изменения.

**Контракт на длительную блокировку по времени** развернут в основной сети Ethereum по адресу [0xEcaE9BF44A21d00E2350a42127A377Bf5856d84B](https://etherscan.io/address/0xecae9bf44a21d00e2350a42127a377bf5856d84b). Он был создан на основе фиксации транзакции \[ожидается в ближайшее время].

**УКАЗАТЬ**

\[ожидается в ближайшее время]

**Контракт на короткую блокировку по времени** развернут в основной сети Etherium по адресу [0xEcaE9BF44A21d00E2350a42127A377Bf5856d84B](https://etherscan.io/address/0xecae9bf44a21d00e2350a42127a377bf5856d84b). Он был создан на основе фиксации транзакции \[ожидается в ближайшее время].

**УКАЗАТЬ**

\[ожидается в ближайшее время]

**Контракт на блокировку дерева Меркла по времени** развернут в основной сети Etherium по адресу [0xd98e7A71BacB6F11438A8271dDB2EFd7f9361F52](https://etherscan.io/address/0xd98e7a71bacb6f11438a8271ddb2efd7f9361f52). Он был создан на основе фиксации транзакции \[ожидается в ближайшее время].

**УКАЗАТЬ**

\[ожидается в ближайшее время]

**Контракт на приоритетную блокировку по времени Starkware** развернут в основной сети Etherium по адресу [0xa306989BA6BcacdECCf3C0614F2B8C668e3CaE](https://etherscan.io/address/0xa306989ba6bcacdeccf3c0614fff2b8c668e3cae). Он был создан на основе фиксации транзакции \[ожидается в ближайшее время].

**УКАЗАТЬ**

\[ожидается в ближайшее время]

## Контракты вознаграждений в виде DYDX

### Дистрибьютор Меркла



![Red dashed lines indicate contract is upgradeable](<.. /.gitbook/assets/Screen Shot 2021-09-03 at 5.23.50 PM.png>)

Смарт-контракт дистрибьютора Меркла распределяет награды в виде токенов DYDX согласно балансам дерева Меркла. Дерево может периодически обновляться с учетом совокупного баланса наград каждого пользователя, что позволяет распределять новые награды между ними с течением времени.

Обновление выражается в установке последнего значения, возвращенного контрактом оракула, для предложенного корня Меркла. Предложенный корень Меркла может быть активен после периода ожидания. В течение периода ожидания управление dYdX может заморозить корень Меркла в случае, если предложенный корень неверный или содержит вредоносный код. Исполнитель с правом на короткую блокировку по времени может возобновить процесс обновления корня.

Смарт-контракт дистрибьютора Меркла был вдохновлен проектами Uniswap и Badger. Смарт-контракт развернут в основной сети Ethereum по адресу 0x01d3348601968aB85b4bb028979006eac235a588. Он был создан на основе фиксации транзакции \[ожидается в ближайшее время].

**УКАЗАТЬ**

\[ожидается в ближайшее время]

### Модуль безопасности



![Red dashed lines indicate contract is upgradeable](<.. /.gitbook/assets/Screen Shot 2021-09-03 at 5.24.45 PM.png>)

Модуль безопасности представляет собой пул стейкинга, который распределяет награды в виде токенов DYDX между пользователями, размещающими DYDX в стейке с целью защиты протокола.

**УКАЗАТЬ**

\[ожидается в ближайшее время]



### Награды для поставщиков ликвидности



![Red dashed lines indicate contract is upgradeable](<.. /.gitbook/assets/Screen Shot 2021-09-03 at 5.25.30 PM.png>)

Модуль ликвидности представляет собой набор смарт-контрактов для стейкинга и займа, которые стимулируют распределение средств в виде USDC с целью поддержания двусторонних котировок на бирже dYdX уровня 2.

За стейкинг USDC стейкеры получают награды в виде токенов DYDX. Предварительно утвержденные партнеры могут заимствовать размещенные в стейке средства на основе репутации и без залогового обеспечения. Средства можно использовать только на бирже уровня 2, что обеспечивается контрактом StarkProxy, который взаимодействует с контрактом StarkEx Perpetual Exchange.

![A diagram of the Liquidity module](<.. /.gitbook/assets/image (66).png>)

### StarkProxy

Этот контракт позволяет своему владельцу заимствовать средства из стейка ликвидности и использовать их в рамках контракта StarkPerpetual. Владелец может вносить дополнительные средства, и любые средства, превышающие сумму займа, можно беспрепятственно вывести. Этот контракт взаимодействует с контрактом [StarkPerpetual](https://github.com/starkware-libs/starkex-contracts/tree/master/scalable-dex/contracts/src/perpetual), созданным Starkware, а также проверенным и развернутым ранее.



### Контракты казны



![Red dashed lines indicate contract is upgradeable](<.. /.gitbook/assets/Screen Shot 2021-09-03 at 5.26.09 PM.png>)

Контракт на вестинг казны был вдохновлен протоколом [Uniswap](https://github.com/Uniswap/governance/blob/master/contracts/TreasuryVester.sol).

Контракт на короткую блокировку по времени может выполнять только те действия, что утверждены управлением.

Контракты на вестинг казны предназначены для получения наград по поощрительному контракту, а контракты казны — для хранения средств казны общего назначения.

Поскольку управление контролирует каждую казну, оно может переводить средства на любой адрес и/или позволять какому-либо адресу расходовать средства любой казны. Например, управление должно будет установить лимиты для токенов в рамках программ вознаграждения.

Каждый контракт на вестинг казны будет осуществлять вестинг токенов равными частями на протяжении \примерно 5 лет (с 3 августа 2021 г. по 3 августа 2026 г.) в соответствующую казну.



## Периферийные контракты

### Награды на базе оракула Chainlink (награды за торговлю и обеспечение ликвидности)

Цель этой системы — расчет и публикация наград в виде токенов DYDX, заработанных трейдерами на бирже dYdX уровня 2, с помощью децентрализованной сети подписантов оракула. Награды хранятся в дереве Меркла, где содержатся совокупные награды каждого пользователя, полученные с начала запуска программы распределения. Каждую эпоху корень Меркла обновляется согласно смарт-контракту MerkleDistributorV1, чтобы показать награды, заработанные за последнюю эпоху.

Для ончейн-публикации данных о наградах мы обеспечили интеграцию с системой-оракулом Chainlink. Для публикации данных о торговле, которые Chainlink использует для создания дерева Меркла, мы используем систему IPNS. Используя систему IPNS, мы можем размещать торговые данные за последнюю эпоху по той же ссылке IPNS, что и за предыдущие эпохи, обеспечивая аналогичное расположение данных.

После расчета соответствующих наград на основе необработанных торговых данных Chainlink публикует дерево Меркла наград в протоколе IPFS. Информация об архитектуре системы вознаграждения Chainlink на базе оракула приводится на следующей диаграмме:

Информация об архитектуре системы вознаграждения Chainlink на базе оракула приводится на следующей диаграмме:

![](<.. /.gitbook/assets/Merkle Distributor.png>)

### Прочие ресурсы

* Ресурсы торговой марки dYdX Foundation доступны [**здесь**](https://dydx.foundation/brand)****
